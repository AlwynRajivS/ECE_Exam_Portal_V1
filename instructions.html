<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exam Instructions</title>

<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#e3f2fd,#f5f5f5);
}
.container{max-width:900px;margin:auto;padding:20px}
.card{
  background:#fff;border-radius:18px;padding:25px;
  box-shadow:0 12px 30px rgba(0,0,0,.2)
}
h2{color:#0d47a1;margin-top:0}
.exam-meta{
  display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px
}
.meta-box{
  background:#f1f5ff;padding:12px;border-radius:10px;font-size:14px
}
.meta-box b{color:#0d47a1}
ul{line-height:1.8;color:#333}
.warning{
  background:#fff3e0;border-left:6px solid #ef6c00;
  padding:15px;border-radius:10px;margin:15px 0
}
.btn{
  background:linear-gradient(135deg,#0d47a1,#1976d2);
  color:#fff;padding:14px;border:none;border-radius:12px;
  font-size:16px;cursor:pointer;width:100%
}
.loading{text-align:center;color:#999}
.footer{text-align:center;color:#666;font-size:13px;margin-top:20px}

.overlay{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.confirmBox{
  background: #2b1a15;
  color: #f6e8e1;
  width: 90%;
  max-width: 360px;
  padding: 22px;
  border-radius: 16px;
  text-align: center;
  box-shadow: 0 10px 30px rgba(0,0,0,0.4);
}

.confirmBox h3{
  margin: 0 0 10px;
}

.confirmBox p{
  font-size: 14px;
  line-height: 1.5;
}

.actions{
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
}

.actions button{
  flex: 1;
  margin: 0 6px;
  padding: 10px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  cursor: pointer;
}

.actions .cancel{
  background: #555;
  color: #fff;
}

.actions .ok{
  background: #1e88e5;
  color: #fff;
}

</style>
</head>

<body>
<div class="container">
<div class="card">

<h2>üìú Examination Instructions</h2>

<div id="loading" class="loading">Loading exam details...</div>

<div id="examDetails" style="display:none">

  <div class="exam-meta">
    <div class="meta-box"><b>Exam ID:</b> <span id="examId"></span></div>
    <div class="meta-box"><b>Exam Name:</b> <span id="examName"></span></div>
    <div class="meta-box"><b>Part A Questions:</b> <span id="partA"></span></div>
    <div class="meta-box"><b>Part B Questions:</b> <span id="partB"></span></div>
    <div class="meta-box"><b>Total Marks:</b> <span id="totalMarks"></span></div>
    <div class="meta-box"><b>Duration:</b> <span id="duration"></span></div>
    <div class="meta-box"><b>Max Violations:</b> <span id="maxViolation"></span></div>
  </div>

  <ul>
    <li>Exam is <b>time bound</b>.</li>
    <li>Full-screen mode is mandatory.</li>
    <li>Tab switch / copy / screen exit are violations.</li>
    <li>Violation limit leads to auto submission.</li>
  </ul>

  <div class="warning">
    ‚ö†Ô∏è Once started, the exam cannot be paused or restarted.
  </div>

 <div id="confirmOverlay" class="overlay">
  <div class="confirmBox">
    <h3>‚ö† Exam Confirmation</h3>
    <p>
      The exam will start in <b>full screen mode</b>.<br>
      Once started, it <b>cannot be paused or restarted</b>.
    </p>

    <div class="actions">
      <button class="cancel" onclick="closeConfirm()">Cancel</button>
      <button class="ok" onclick="startExam()">OK</button>
    </div>
  </div>
</div>
<button class="btn" onclick="openConfirm()">Start Exam</button>


<div class="footer">Online Examination System</div>
</div>
</div>

<script>
/* ================= CONFIG ================= */
const API_URL =
"https://script.google.com/macros/s/AKfycbwv9JOGiX4AxbPMhAp-cMxjPDyt1ZWK_FY7976wUPh5Qt_5Y0T7o9sy5rq7np3UyCr5/exec";

/* ================= GET exam_id ================= */
const examId = sessionStorage.getItem("exam_id");
const examTitle = sessionStorage.getItem("exam_title");

console.log("Exam ID from session:", examId);

if (!examId) {
  document.getElementById("loading").innerText =
    "Session expired. Please start exam again.";
} else {

  fetch(API_URL,{
    method:"POST",
    headers:{"Content-Type":"application/x-www-form-urlencoded"},
    body:new URLSearchParams({
      action:"getExamMeta",
      exam_id:examId
    })
  })
  .then(r=>r.json())
  .then(data=>{
    if(data.error){
      document.getElementById("loading").innerText=data.error;
      return;
    }

    document.getElementById("examId").innerText = examId;
    document.getElementById("examName").innerText = data.exam_name;
    document.getElementById("partA").innerText = data.partA;
    document.getElementById("partB").innerText = data.partB;
    document.getElementById("duration").innerText = data.duration;
    document.getElementById("maxViolation").innerText = data.violation_limit;

    document.getElementById("totalMarks").innerText =
      Number(data.partA) + Number(data.partB)*2;

    document.getElementById("loading").style.display="none";
    document.getElementById("examDetails").style.display="block";
  })
  .catch(()=>{
    document.getElementById("loading").innerText="Failed to load exam data";
  });
}


function openConfirm(){
  document.getElementById("confirmOverlay").style.display = "flex";
}

function closeConfirm(){
  document.getElementById("confirmOverlay").style.display = "none";
}

function startExam(){
  closeConfirm();

  if (document.documentElement.requestFullscreen) {
    document.documentElement.requestFullscreen();
  }

  location.href = "exam.html";
}

</script>

</body>
</html>
